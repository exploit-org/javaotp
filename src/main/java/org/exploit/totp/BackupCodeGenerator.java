package org.exploit.totp;

import org.exploit.totp.config.BackupCodeConfig;

import java.security.SecureRandom;
import java.util.ArrayList;
import java.util.List;

public class BackupCodeGenerator {
    private static final String CHARACTERS = "23456789ABCDEFGHJKLMNPQRSTUVWXYZ";
    private static final SecureRandom SECURE_RANDOM = new SecureRandom();

    private final BackupCodeConfig config;

    public BackupCodeGenerator(BackupCodeConfig config) {
        this.config = config;
    }

    public List<String> generateCodes() {
        var count = config.getCount();
        var codes = new ArrayList<String>(count);

        for (var i = 0; i < count; i++)
            codes.add(generateCode());

        return codes;
    }

    public String generateCode() {
        var length = config.getLength();
        var code = new char[length];

        for (var i = 0; i < length; i++) {
            var randomIndex = SECURE_RANDOM.nextInt(CHARACTERS.length());
            code[i] = CHARACTERS.charAt(randomIndex);
        }

        return new String(code);
    }
}
